dist: focal

language: ruby

git:
  depth: 200

rvm:
  - 2.7.1

# before_install:
#   - sudo apt-get install -y libpango1.0-dev ghostscript fonts-lyx jing libavalon-framework-java libbatik-java
#   - gem install asciidoctor -v 2.0.16
#   - gem install coderay -v 1.1.1
#   - gem install rouge -v 3.19.0
#   - gem install ttfunk -v 1.5.1
#   - gem install hexapdf -v 0.27.0
#   - gem install asciidoctor-pdf -v 1.5.0
#   - gem install asciidoctor-mathematical -v 0.3.5

script:
  - git describe --tags --dirty
  - ./info_script
  - make -C xml validate
  - make -O -j 5 api c env ext cxx4opencl manhtmlpages

deploy:
  provider: releases
  api_key: $GH_TOKEN
  file_glob: true
  file: out/pdf/*
  skip_cleanup: true
  on:
    tags: true
  edge: true
