dist: xenial

language: ruby

git:
  depth: 200

rvm:
  - 2.3.3

before_install:
  - sudo apt-get install -y libpango1.0-dev ghostscript
  - gem install asciidoctor -v 1.5.8
  - gem install coderay json-schema
  - gem install ttfunk -v 1.5.1
  - gem install asciidoctor-pdf -v 1.5.0.beta.8 --pre
  - MATHEMATICAL_SKIP_STRDUP=1 gem install asciidoctor-mathematical -v 0.2.2

script:
  - git describe --tags --dirty
  # This produces an error because travis-ci works with a "detached head".
  #- git symbolic-ref --short HEAD
  - make api c env ext

#after_success:
#  - cd out
#  - git init
#  - git config user.name "${GH_USER_NAME}"
#  - git config user.email "${GH_USER_EMAIL}"
#  - git add html pdf ; git commit -m "Deploy to Github Pages"
#  - git push -f "https://${GH_TOKEN}@${GH_REF}" master:gh-pages

after_success:
  - mkdir deploy
  - cp -R out/html out/pdf deploy

deploy:
  verbose: true
  provider: pages
  local_dir: deploy
  skip_cleanup: true
  github_token: $GH_TOKEN
  #keep_history: true
  on:
    #branch: master
    branch: travis-ci
